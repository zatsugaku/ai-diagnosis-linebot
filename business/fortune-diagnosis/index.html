<!DOCTYPE html>
<html lang="ja">
<head>
    <!-- ========================================= -->
    <!-- ğŸ·ï¸ HEAD: ãƒ¡ã‚¿æƒ…å ±ãƒ»ã‚¹ã‚¿ã‚¤ãƒ« -->
    <!-- ä¿®æ­£é »åº¦: ä½ / å½±éŸ¿ç¯„å›²: ãƒ‡ã‚¶ã‚¤ãƒ³å…¨ä½“ -->
    <!-- ã“ã“ã‚’ä¿®æ­£ã™ã‚‹ã¨: è‰²ãƒ»ãƒ•ã‚©ãƒ³ãƒˆãƒ»ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒå¤‰ã‚ã‚Šã¾ã™ -->
    <!-- ========================================= -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”® å ã„é©æ€§è¨ºæ–­ v2.1 - 3åˆ†ã§åˆ¤æ˜ã™ã‚‹ã‚ãªãŸã«ãƒ”ãƒƒã‚¿ãƒªã®å ã„æ‰‹æ³•</title>
    <meta name="description" content="ã‚¿ãƒ­ãƒƒãƒˆã€å æ˜Ÿè¡“ã€æ‰‹ç›¸ãªã©ã€ã‚ãªãŸã®æ€§æ ¼ã‚„ä¾¡å€¤è¦³ã‹ã‚‰æœ€é©ãªå ã„æ‰‹æ³•ã‚’è¨ºæ–­ã€‚1,000äººã®è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãç²¾å¯†ãªé©æ€§åˆ†æã‚·ã‚¹ãƒ†ãƒ ã€‚">
    
    <style>
        /* ==============================================
           ğŸ¨ å…¨ä½“ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š
           ============================================== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
            overflow: hidden;
            min-height: 95vh;
            display: flex;
            flex-direction: column;
        }

        /* ==============================================
           ğŸ¨ ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ã‚¿ã‚¤ãƒˆãƒ«éƒ¨åˆ†
           ============================================== */
        .header {
            background: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%);
            color: white;
            text-align: center;
            padding: 30px 30px 20px 30px;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 10px,
                rgba(255,255,255,0.1) 10px,
                rgba(255,255,255,0.1) 20px
            );
            animation: backgroundMove 20s linear infinite;
        }

        @keyframes backgroundMove {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .header h1 {
            font-size: 2.2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: 700;
        }

        .header .subtitle {
            font-size: 1.1em;
            opacity: 0.95;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .header .description {
            font-size: 1em;
            opacity: 0.9;
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.4;
        }

        /* ==============================================
           ğŸ¨ ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢
           ============================================== */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            justify-content: center;
        }

        /* ==============================================
           ğŸ¨ ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
           ============================================== */
        .progress-container {
            margin-bottom: 20px;
            flex-shrink: 0;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-text {
            font-size: 1em;
            font-weight: 600;
            color: #9c27b0;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, #e9ecef 0%, #f8f9fa 100%);
            border-radius: 4px;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #9c27b0 0%, #673ab7 100%);
            width: 0%;
            transition: width 0.8s ease;
            border-radius: 4px;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* ==============================================
           ğŸ¨ è³ªå•ã‚«ãƒ¼ãƒ‰
           ============================================== */
        .question-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0;
        }

        .question-card {
            background: linear-gradient(135deg, #faf0ff 0%, #f3e7ff 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(156, 39, 176, 0.15);
            border: 2px solid rgba(156, 39, 176, 0.1);
            position: relative;
            overflow: hidden;
            animation: slideInFromBottom 0.6s ease-out;
            width: 100%;
            max-width: 800px;
        }

        @keyframes slideInFromBottom {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #9c27b0 0%, #673ab7 100%);
        }

        .question-category {
            background: linear-gradient(90deg, #9c27b0 0%, #673ab7 100%);
            color: white;
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            display: inline-block;
            margin-bottom: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .question-text {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 25px;
            color: #2d3436;
            line-height: 1.4;
        }

        /* ==============================================
           ğŸ¨ é¸æŠè‚¢ãƒ»ãƒœã‚¿ãƒ³
           ============================================== */
        .options-container {
            display: grid;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option {
            background: white;
            border: 2px solid #e0d4ff;
            border-radius: 12px;
            padding: 18px 22px;
            cursor: pointer;
            transition: all 0.4s ease;
            font-size: 1em;
            position: relative;
            overflow: hidden;
            font-weight: 500;
        }

        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(156, 39, 176, 0.1), transparent);
            transition: left 0.6s ease;
        }

        .option:hover {
            border-color: #9c27b0;
            background: #faf0ff;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(156, 39, 176, 0.2);
        }

        .option:hover::before {
            left: 100%;
        }

        .option.selected {
            border-color: #9c27b0;
            background: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(156, 39, 176, 0.4);
        }

        /* ==============================================
           ğŸ¨ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯è¡¨ç¤º
           ============================================== */
        .integrated-feedback {
            background: linear-gradient(135deg, #ff6090 0%, #ff4757 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
            box-shadow: 0 8px 25px rgba(255, 71, 87, 0.3);
            border: 2px solid rgba(255,255,255,0.2);
            animation: slideInFromRight 0.5s ease-out;
        }

        @keyframes slideInFromRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .feedback-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feedback-content {
            font-size: 1em;
            line-height: 1.5;
            opacity: 0.95;
        }

        /* ==============================================
           ğŸ¨ ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ»æ“ä½œãƒœã‚¿ãƒ³
           ============================================== */
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            gap: 15px;
            flex-shrink: 0;
        }

        .nav-button {
            padding: 15px 35px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            flex: 1;
            max-width: 200px;
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .prev-button {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
            color: white;
        }

        .prev-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(149, 165, 166, 0.4);
        }

        .next-button {
            background: linear-gradient(135deg, #ff6090 0%, #ff4757 100%);
            color: white;
        }

        .next-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 71, 87, 0.4);
        }

        .ai-analysis-button {
            background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%);
            color: #333;
            border: none;
            padding: 18px 45px;
            border-radius: 25px;
            font-size: 1.3em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 20px auto;
            display: block;
            box-shadow: 0 10px 30px rgba(255, 183, 0, 0.3);
            width: 100%;
            max-width: 350px;
        }

        .ai-analysis-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(255, 183, 0, 0.4);
        }

        /* ==============================================
           ğŸ¨ çµæœè¡¨ç¤ºãƒ»åˆ†æç”»é¢
           ============================================== */
        .loading-container {
            text-align: center;
            margin: 30px 0;
            display: none;
            background: linear-gradient(135deg, #faf0ff 0%, #f3e7ff 100%);
            padding: 30px;
            border-radius: 20px;
            border: 2px solid rgba(156, 39, 176, 0.1);
        }

        .loading-container h2 {
            color: #9c27b0;
            margin-bottom: 25px;
            font-size: 1.8em;
        }

        .loading-step {
            padding: 15px 25px;
            margin: 12px 0;
            border-radius: 10px;
            background: white;
            transition: all 0.4s ease;
            border: 1px solid #e0d4ff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.95em;
        }

        .loading-step.active {
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border-left: 4px solid #fdcb6e;
            transform: translateX(10px);
        }

        .loading-step.completed {
            background: linear-gradient(135deg, #d4edda 0%, #a8e6cf 100%);
            border-left: 4px solid #00b894;
            transform: translateX(5px);
        }

        .results-card {
            background: linear-gradient(135deg, #ff6090 0%, #ff4757 100%);
            color: white;
            padding: 40px;
            border-radius: 25px;
            text-align: center;
            margin-top: 30px;
            display: none;
            box-shadow: 0 20px 45px rgba(255, 71, 87, 0.3);
            border: 3px solid rgba(255,255,255,0.2);
            animation: slideInFromBottom 0.8s ease-out;
        }

        .score-display {
            font-size: 4.5em;
            font-weight: bold;
            margin: 25px 0;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.3);
            background: rgba(255,255,255,0.2);
            border-radius: 20px;
            padding: 25px;
            display: inline-block;
            min-width: 250px;
        }

        .fortune-type-display {
            font-size: 2.2em;
            margin: 25px 0;
            padding: 18px;
            background: rgba(255,255,255,0.15);
            border-radius: 15px;
            font-weight: 600;
        }

        .score-analysis {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: left;
        }

        .ai-analysis-card {
            margin-top: 30px;
            background: linear-gradient(135deg, #faf0ff 0%, #f3e7ff 100%);
            border-radius: 20px;
            padding: 35px;
            display: none;
            border: 2px solid #9c27b0;
            box-shadow: 0 12px 30px rgba(156, 39, 176, 0.1);
            animation: slideInFromBottom 0.8s ease-out;
        }

        /* ==============================================
           ğŸ¨ ãã®ä»–ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
           ============================================== */
        .cta-section {
            background: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%);
            color: white;
            padding: 35px;
            border-radius: 20px;
            text-align: center;
            margin-top: 30px;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .cta-section h2 {
            margin-bottom: 18px;
            font-size: 2em;
        }

        .cta-section p {
            font-size: 1.1em;
            margin-bottom: 20px;
            opacity: 0.95;
        }

        .cta-button {
            background: white;
            color: #9c27b0;
            padding: 18px 40px;
            border: none;
            border-radius: 25px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 15px 10px;
            text-decoration: none;
            display: inline-block;
            box-shadow: 0 8px 25px rgba(255,255,255,0.2);
            min-width: 220px;
        }

        .cta-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(255,255,255,0.3);
        }

        .highlight-box {
            background: linear-gradient(135deg, #fef5ff 0%, #fcebff 100%);
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            border-left: 5px solid #ff6090;
            box-shadow: 0 6px 20px rgba(255, 96, 144, 0.1);
        }

        .error-message {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
            text-align: center;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .temporary-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            color: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            animation: slideDown 0.3s ease;
        }

        .temporary-message.info { background: #2196F3; }
        .temporary-message.warning { background: #ff9800; }
        .temporary-message.success { background: #4CAF50; }
        .temporary-message.error { background: #f44336; }

        @keyframes slideDown {
            from { transform: translate(-50%, -100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        /* ğŸ” ãƒ¬ãƒ“ãƒ¥ãƒ¼æ¤œè¨¼ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .review-banner {
            background: linear-gradient(135deg, #ffd700 0%, #ffb700 100%);
            color: #333;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            position: relative;
            z-index: 1000;
        }

        /* ==============================================
           ğŸ“± ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œ
           ============================================== */
        @media (max-width: 768px) {
            body { padding: 5px; }
            .container { border-radius: 15px; min-height: 98vh; }
            .header { padding: 20px 15px 15px 15px; }
            .header h1 { font-size: 1.8em; }
            .main-content { padding: 15px; }
            .question-card { padding: 25px 20px; }
            .navigation { flex-direction: column; gap: 12px; }
            .nav-button { width: 100%; max-width: none; }
        }
    </style>
</head>

<body>
    <!-- ğŸ” ãƒ¬ãƒ“ãƒ¥ãƒ¼æ¤œè¨¼ãƒãƒŠãƒ¼ -->
    <div class="review-banner">
        ğŸ” AI Reviewer v4.0 æ¤œè¨¼ãƒ¢ãƒ¼ãƒ‰ - Option Bä¿®æ­£æº–å‚™çŠ¶æ³ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¸­
    </div>

    <!-- ========================================= -->
    <!-- ğŸ“± BODY: HTMLæ§‹é€  -->  
    <!-- ä¿®æ­£é »åº¦: ä½ / å½±éŸ¿ç¯„å›²: ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ -->
    <!-- ã“ã“ã‚’ä¿®æ­£ã™ã‚‹ã¨: ç”»é¢ã®æ§‹é€ ãƒ»é…ç½®ãŒå¤‰ã‚ã‚Šã¾ã™ -->
    <!-- ========================================= -->
    <div class="container">
        <header class="header">
            <div class="header-content">
                <h1>ğŸ”® å ã„é©æ€§è¨ºæ–­ v2.1</h1>
                <div class="subtitle">3åˆ†ã§åˆ¤æ˜ã™ã‚‹ã‚ãªãŸã«ãƒ”ãƒƒã‚¿ãƒªã®å ã„æ‰‹æ³•</div>
                <div class="description">
                    ã‚¿ãƒ­ãƒƒãƒˆã€å æ˜Ÿè¡“ã€æ‰‹ç›¸ãªã©ã€ã‚ãªãŸã®æ€§æ ¼ã‚„ä¾¡å€¤è¦³ã‹ã‚‰æœ€é©ãªå ã„æ‰‹æ³•ã‚’è¨ºæ–­ã€‚
                    1,000äººã®è¨ºæ–­ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ãç²¾å¯†ãªé©æ€§åˆ†æã‚·ã‚¹ãƒ†ãƒ ã§ã™ã€‚
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="progress-container">
                <div class="progress-info">
                    <span class="progress-text" id="progress-text">è³ªå•1 / 8</span>
                    <span class="progress-text" id="completion-rate">å®Œäº†ç‡: 12%</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill"></div>
                </div>
            </div>

            <div class="question-container" id="question-container">
                <div class="question-text">ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆæœŸåŒ–ä¸­...</div>
            </div>

            <nav class="navigation">
                <button class="nav-button prev-button" id="prev-button" onclick="diagnosisSystem.previousQuestion()" disabled>
                    â† å‰ã®è³ªå•ã«æˆ»ã‚‹
                </button>
                <button class="nav-button next-button" id="next-button" onclick="diagnosisSystem.nextQuestion()" disabled>
                    æ¬¡ã®è³ªå•ã¸ â†’
                </button>
            </nav>

            <button class="ai-analysis-button" id="ai-analysis-button" onclick="diagnosisSystem.startAIAnalysis()" style="display: none;">
                ğŸ”® è©³ç´°ãªå ã„åˆ†æã‚’é–‹å§‹
            </button>

            <div class="loading-container" id="loading-container">
                <h2>ğŸ”® å ã„é©æ€§åˆ†æä¸­...</h2>
                <div class="loading-step" id="step1">
                    <span>ğŸŒŸ ã‚ãªãŸã®æ€§æ ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æä¸­...</span>
                    <span class="spinner">â³</span>
                </div>
                <div class="loading-step" id="step2">
                    <span>â˜¯ï¸ ä¾¡å€¤è¦³ã¨å ã„æ‰‹æ³•ã®ç›¸æ€§ã‚’è¨ˆç®—ä¸­...</span>
                    <span class="spinner">â³</span>
                </div>
                <div class="loading-step" id="step3">
                    <span>ğŸ´ æœ€é©ãªå ã„æ‰‹æ³•ã‚’ç‰¹å®šä¸­...</span>
                    <span class="spinner">â³</span>
                </div>
                <div class="loading-step" id="step4">
                    <span>âœ¨ ãƒ‘ãƒ¼ã‚½ãƒŠãƒ©ã‚¤ã‚ºã•ã‚ŒãŸã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ç”Ÿæˆä¸­...</span>
                    <span class="spinner">â³</span>
                </div>
                <div class="loading-step" id="step5">
                    <span>ğŸ“‹ è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’å®Œæˆä¸­...</span>
                    <span class="spinner">â³</span>
                </div>
            </div>

            <div class="results-card" id="results-card">
                <h2>ğŸ”® ã‚ãªãŸã®ç‰¹æ€§è¨ºæ–­çµæœ</h2>
                <div class="score-display" id="final-score">ç‰¹æ€§åˆ†æä¸­...</div>
                <div class="fortune-type-display" id="fortune-type">æœ€é©ãªå ã„æ‰‹æ³•åˆ¤å®šä¸­...</div>
                <div class="score-analysis" id="score-message">
                    <h3>ğŸ¯ ã‚ãªãŸã®ãƒ‘ãƒ¼ã‚½ãƒŠãƒªãƒ†ã‚£ã‚¿ã‚¤ãƒ—</h3>
                    <p id="position-message">ç‰¹æ€§åˆ†æãƒ¡ãƒƒã‚»ãƒ¼ã‚¸</p>
                    <h3>ğŸŒŸ æœ€é©ãªå ã„æ´»ç”¨æ³•</h3>
                    <p id="action-message">æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³</p>
                </div>
            </div>

            <div class="ai-analysis-card" id="ai-analysis-section">
                <div id="analysis-content"></div>
            </div>

            <div class="cta-section">
                <h2>ğŸ”® ç„¡æ–™å ã„ä½“é¨“ã‚»ãƒƒã‚·ãƒ§ãƒ³</h2>
                <p>è¨ºæ–­çµæœã‚’åŸºã«ã€ã‚ãªãŸã«æœ€é©ãªå ã„å¸«ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚</p>
                <p>åˆå›30åˆ†ã®ä½“é¨“ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç„¡æ–™ã§ã”æä¾›ã€‚</p>
                <a href="mailto:fortune@example.com?subject=å ã„é©æ€§è¨ºæ–­çµæœã®ã”ç›¸è«‡&body=è¨ºæ–­çµæœã‚’åŸºã«å ã„ä½“é¨“ã‚’å¸Œæœ›ã—ã¾ã™ã€‚" class="cta-button">
                    ğŸ“§ ç„¡æ–™ä½“é¨“ã‚’ç”³ã—è¾¼ã‚€
                </a>
            </div>
        </main>
    </div>

    <!-- ========================================= -->
    <!-- ğŸ“Š CONFIG: è¨­å®šãƒ‡ãƒ¼ã‚¿ -->
    <!-- ä¿®æ­£é »åº¦: ä¸­ / å½±éŸ¿ç¯„å›²: è¨ºæ–­å†…å®¹ -->
    <!-- ã“ã“ã‚’ä¿®æ­£ã™ã‚‹ã¨: ã‚¿ã‚¤ãƒˆãƒ«ãƒ»è³ªå•æ•°ãƒ»APIãŒå¤‰ã‚ã‚Šã¾ã™ -->
    <!-- ========================================= -->
    <script>
        // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šï¼ˆã‚¿ã‚¤ãƒˆãƒ«ãƒ»åŸºæœ¬è¨­å®šã®å¤‰æ›´ã¯ã“ã“ï¼‰
        window.SYSTEM_CONFIG = {
          title: "ğŸ”® å ã„é©æ€§è¨ºæ–­ v2.1",
          subtitle: "3åˆ†ã§åˆ¤æ˜ã™ã‚‹ã‚ãªãŸã«ãƒ”ãƒƒã‚¿ãƒªã®å ã„æ‰‹æ³•",
          maxScore: 80,
          completionMessage: "è¨ºæ–­å®Œäº†ï¼ã‚ãªãŸã«æœ€é©ãªå ã„æ‰‹æ³•ã¨è©³ç´°ãªé©æ€§åˆ†æã‚’ã”ç¢ºèªãã ã•ã„ã€‚",
          apiEndpoint: "/api/fortune-analyze",
          hideAmountDisplay: true,
          fortuneMode: true
        };

        // è³ªå•ãƒ‡ãƒ¼ã‚¿ï¼ˆç°¡ç•¥ç‰ˆ - å®Ÿéš›ã¯ external file ã‹ã‚‰èª­ã¿è¾¼ã¿ï¼‰
        window.QUESTION_DATA = [
            {
                text: "Q1. æ—¥å¸¸ç”Ÿæ´»ã§ç›´æ„Ÿã‚„ã€Œãªã‚“ã¨ãªãã€ã®æ„Ÿè¦šã‚’ä¿¡ã˜ã¦è¡Œå‹•ã™ã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã™ã‹ï¼Ÿ",
                category: "ç›´æ„Ÿãƒ»æ„Ÿæ€§",
                options: [
                    "ç›´æ„Ÿã‚’ã¨ã¦ã‚‚ä¿¡ã˜ã¦ã€ã‚ˆãç›´æ„Ÿã§åˆ¤æ–­ã™ã‚‹",
                    "ç›´æ„Ÿã¯å‚è€ƒç¨‹åº¦ã«ã€æœ€çµ‚çš„ã«ã¯è«–ç†ã§åˆ¤æ–­",
                    "ç›´æ„Ÿã¨è«–ç†ã®ãƒãƒ©ãƒ³ã‚¹ã‚’å–ã£ã¦åˆ¤æ–­ã™ã‚‹",
                    "ã»ã¨ã‚“ã©è«–ç†çš„æ€è€ƒã§åˆ¤æ–­ã—ã€ç›´æ„Ÿã¯é‡è¦–ã—ãªã„"
                ],
                scores: [10, 7, 5, 2],
                amounts: [80, 65, 50, 30],
                feedbacks: [
                    {
                        title: "ğŸŒŸ ç›´æ„ŸåŠ›ã®æŒã¡ä¸»",
                        content: "ã‚ãªãŸã¯è±Šã‹ãªç›´æ„ŸåŠ›ã‚’æŒã¡ã€æ„Ÿæ€§ã‚’å¤§åˆ‡ã«ã™ã‚‹æ–¹ã§ã™ã­ã€‚å†…ãªã‚‹å£°ã«è€³ã‚’å‚¾ã‘ã‚‹èƒ½åŠ›ã«é•·ã‘ã¦ãŠã‚Šã€å‰µé€ çš„ãªåˆ¤æ–­ãŒã§ãã‚‹ç‰¹è³ªãŒã‚ã‚Šã¾ã™ã€‚"
                    },
                    {
                        title: "âš–ï¸ ãƒãƒ©ãƒ³ã‚¹æ„Ÿè¦šã«å„ªã‚ŒãŸã‚¿ã‚¤ãƒ—",
                        content: "ç›´æ„Ÿã¨è«–ç†ã®ãƒãƒ©ãƒ³ã‚¹ã‚’ä¸Šæ‰‹ã«å–ã‚‹æ–¹ã§ã™ã­ã€‚çŠ¶æ³ã«å¿œã˜ã¦æŸ”è»Ÿã«ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¤‰ãˆã‚‹é©å¿œåŠ›ã‚’ãŠæŒã¡ã§ã™ã€‚"
                    },
                    {
                        title: "ğŸ”„ èª¿å’Œã‚’é‡è¦–ã™ã‚‹æ€§æ ¼", 
                        content: "ç‰©äº‹ã‚’å¤šè§’çš„ã«æ‰ãˆã€ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸåˆ¤æ–­ã‚’å¿ƒãŒã‘ã‚‹æ–¹ã§ã™ã­ã€‚å®‰å®šæ„ŸãŒã‚ã‚Šã€å‘¨å›²ã‹ã‚‰ã®ä¿¡é ¼ã‚‚åšã„ã‚¿ã‚¤ãƒ—ã§ã™ã€‚"
                    },
                    {
                        title: "ğŸ§  è«–ç†çš„æ€è€ƒã®é”äºº",
                        content: "å®¢è¦³çš„ã§å†·é™ãªåˆ¤æ–­åŠ›ã‚’ãŠæŒã¡ã§ã™ã­ã€‚ãƒ‡ãƒ¼ã‚¿ã‚„äº‹å®Ÿã‚’é‡è¦–ã—ã€ç¢ºå®Ÿæ€§ã‚’æ±‚ã‚ã‚‹æ…é‡ã§ä¿¡é ¼æ€§ã®é«˜ã„æ€§æ ¼ã§ã™ã€‚"
                    }
                ]
            }
            // ä»–ã®è³ªå•ã¯å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¾ã‚Œã¾ã™
        ];

        console.log('âœ… å ã„é©æ€§è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ  v2.1 - ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–å®Œäº†');
        console.log(`ğŸ“Š è³ªå•æ•°: ${window.QUESTION_DATA?.length || 1}å•`);
        console.log(`ğŸ”® å ã„æ‰‹æ³•: 11ç¨®é¡å¯¾å¿œ`);
    </script>

    <!-- ========================================= -->
    <!-- ğŸ§  MAIN-SYSTEM: ãƒ¡ã‚¤ãƒ³è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ  -->
    <!-- ä¿®æ­£é »åº¦: ä½ / å½±éŸ¿ç¯„å›²: å‹•ä½œå…¨ä½“ -->
    <!-- âš ï¸ æ³¨æ„: ã“ã“ã¯å®‰å®šå‹•ä½œä¸­ã®ãŸã‚åŸºæœ¬çš„ã«ã¯ä¿®æ­£ã—ãªã„ -->
    <!-- ========================================= -->
    <script>
        // è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ ã‚¯ãƒ©ã‚¹ï¼ˆãƒ¡ã‚¤ãƒ³å‡¦ç†ãƒ»åŸºæœ¬çš„ã«ã¯ä¿®æ­£ä¸è¦ï¼‰
        class DiagnosisSystem {
            constructor() {
                this.currentQuestion = 0;
                this.answers = [];
                this.totalScore = 0;
                this.totalImprovement = 0;
                this.questionData = window.QUESTION_DATA;
                this.startTime = new Date();
                this.sessionId = this.getSessionId();
                this.debugMode = true;
                this.retryCount = 0;
                this.maxRetries = 3;
                
                console.log('ğŸ”® å ã„é©æ€§è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
                this.initializeDiagnosis();
            }

            getSessionId() {
                let sessionId = sessionStorage.getItem('fortune_session_id');
                if (!sessionId) {
                    sessionId = 'fortune_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    sessionStorage.setItem('fortune_session_id', sessionId);
                }
                return sessionId;
            }

            showTemporaryMessage(message, type = 'info') {
                const messageDiv = document.createElement('div');
                messageDiv.className = `temporary-message ${type}`;
                messageDiv.textContent = message;
                
                document.body.appendChild(messageDiv);
                
                setTimeout(() => {
                    messageDiv.style.animation = 'slideUp 0.3s ease';
                    setTimeout(() => messageDiv.remove(), 300);
                }, 3000);
            }

            initializeDiagnosis() {
                try {
                    this.showQuestion();
                    this.updateProgress();
                    this.updateNavigation();
                    
                    console.log('âœ… è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
                } catch (error) {
                    console.error('ğŸ’¥ åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                    this.showError('ã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');
                }
            }

            showError(message) {
                const container = document.getElementById('question-container');
                container.innerHTML = `
                    <div class="error-message">
                        <h3>âš ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼</h3>
                        <p>${message}</p>
                        <button onclick="location.reload()" class="cta-button" style="margin-top: 20px; background: white; color: #ff6b6b;">
                            ğŸ”„ ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿
                        </button>
                    </div>
                `;
            }

            showQuestion() {
                if (!this.questionData || this.currentQuestion >= this.questionData.length) {
                    this.showResults();
                    return;
                }

                const question = this.questionData[this.currentQuestion];
                const container = document.getElementById('question-container');
                
                container.innerHTML = `
                    <div class="question-card">
                        <div class="question-category">${question.category}</div>
                        <div class="question-text">${question.text}</div>
                        <div class="options-container">
                            ${question.options.map((option, index) => `
                                <div class="option" data-index="${index}" onclick="diagnosisSystem.selectOption(${index})" role="button" tabindex="0">
                                    ${option}
                                </div>
                            `).join('')}
                        </div>
                        <div class="integrated-feedback" id="feedback-${this.currentQuestion}">
                            <div class="feedback-title"></div>
                            <div class="feedback-content"></div>
                        </div>
                    </div>
                `;

                // æ—¢ã«å›ç­”ãŒã‚ã‚‹å ´åˆã¯é¸æŠçŠ¶æ…‹ã‚’å¾©å…ƒ
                if (this.answers[this.currentQuestion] !== undefined) {
                    this.selectOption(this.answers[this.currentQuestion].selectedIndex, false);
                }
            }

            selectOption(optionIndex, animate = true) {
                // å‰ã®é¸æŠã‚’ã‚¯ãƒªã‚¢
                document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
                
                // æ–°ã—ã„é¸æŠã‚’ãƒãƒ¼ã‚¯
                const selectedOption = document.querySelector(`[data-index="${optionIndex}"]`);
                if (selectedOption) {
                    selectedOption.classList.add('selected');
                }

                const question = this.questionData[this.currentQuestion];
                const score = question.scores[optionIndex];
                const amount = question.amounts[optionIndex];
                const feedback = question.feedbacks[optionIndex];

                // å›ç­”ã‚’ä¿å­˜
                this.answers[this.currentQuestion] = {
                    selectedIndex: optionIndex,
                    score: score,
                    amount: amount,
                    timestamp: new Date(),
                    category: question.category
                };

                // çµ±åˆãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’è¡¨ç¤º
                const feedbackCard = document.getElementById(`feedback-${this.currentQuestion}`);
                const feedbackTitle = feedbackCard.querySelector('.feedback-title');
                const feedbackContent = feedbackCard.querySelector('.feedback-content');
                
                feedbackTitle.textContent = feedback.title;
                feedbackContent.textContent = feedback.content;
                feedbackCard.style.display = 'block';

                // ç´¯è¨ˆã‚’æ›´æ–°
                this.updateTotals();
                this.updateNavigation();

                console.log(`Q${this.currentQuestion + 1} å›ç­”:`, {
                    option: optionIndex,
                    score: score,
                    totalScore: this.totalScore
                });
            }

            updateTotals() {
                this.totalScore = 0;
                this.totalImprovement = 0;

                // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šè©³ç´°ãƒ­ã‚°
                console.log('ğŸ“¢ ã‚¹ã‚³ã‚¢é›†è¨ˆé–‹å§‹:', {
                    answersLength: this.answers.length,
                    answers: this.answers
                });

                this.answers.forEach((answer, index) => {
                    if (answer !== undefined) {
                        console.log(`ğŸ“ Q${index+1}: score=${answer.score}, ç´¯è¨ˆ=${this.totalScore + answer.score}`);
                        this.totalScore += answer.score;
                        this.totalImprovement += answer.amount;
                    } else {
                        console.log(`âŒ Q${index+1}: æœªå›ç­”`);
                    }
                });

                console.log('âœ… ã‚¹ã‚³ã‚¢é›†è¨ˆå®Œäº†:', {
                    totalScore: this.totalScore,
                    totalImprovement: this.totalImprovement
                });
            }

            updateProgress() {
                const progress = ((this.currentQuestion + 1) / this.questionData.length) * 100;
                const completionRate = Math.round(progress);
                
                document.getElementById('progress-fill').style.width = `${progress}%`;
                document.getElementById('progress-text').textContent = `è³ªå•${this.currentQuestion + 1} / ${this.questionData.length}`;
                // âœ… ç‚¹æ•°åˆ¶ã®è¡¨ç¾ã‚’ç‰¹æ€§åˆ†æã«å¤‰æ›´
                document.getElementById('completion-rate').textContent = `ç‰¹æ€§åˆ†æ: ${completionRate}% å®Œäº†`;
            }

            updateNavigation() {
                const prevButton = document.getElementById('prev-button');
                const nextButton = document.getElementById('next-button');

                prevButton.disabled = this.currentQuestion === 0;
                nextButton.disabled = this.answers[this.currentQuestion] === undefined;

                // æœ€å¾Œã®è³ªå•ã®å ´åˆ
                if (this.currentQuestion === this.questionData.length - 1 && this.answers[this.currentQuestion] !== undefined) {
                    nextButton.style.display = 'none';
                    document.getElementById('ai-analysis-button').style.display = 'block';
                } else {
                    nextButton.style.display = 'inline-block';
                    document.getElementById('ai-analysis-button').style.display = 'none';
                }
            }

            previousQuestion() {
                if (this.currentQuestion > 0) {
                    this.currentQuestion--;
                    this.showQuestion();
                    this.updateProgress();
                    this.updateNavigation();
                }
            }

            nextQuestion() {
                if (this.currentQuestion < this.questionData.length - 1) {
                    this.currentQuestion++;
                    this.showQuestion();
                    this.updateProgress();
                    this.updateNavigation();
                } else {
                    this.showResults();
                }
            }

            showResults() {
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’éè¡¨ç¤º
                document.querySelector('.navigation').style.display = 'none';
                
                // AIåˆ†æãƒœã‚¿ãƒ³ã‚’è¡¨ç¤º
                document.getElementById('ai-analysis-button').style.display = 'block';
                
                // è³ªå•ã‚³ãƒ³ãƒ†ãƒŠã‚’éè¡¨ç¤º
                document.getElementById('question-container').style.display = 'none';
                
                // çµæœã‚’è¡¨ç¤º
                this.displayFinalResults();
            }

            displayFinalResults() {
                const resultsCard = document.getElementById('results-card');
                const finalScore = document.getElementById('final-score');
                const fortuneTypeDisplay = document.getElementById('fortune-type');
                const positionMessage = document.getElementById('position-message');
                const actionMessage = document.getElementById('action-message');

                // âœ… ç‰¹æ€§åˆ†æçµæœã‚’å–å¾—
                const fortuneResult = this.determineFortuneType();
                
                console.log('ğŸ“Š ç‰¹æ€§ã«ã‚ˆã‚‹æœ€çµ‚åˆ†æ:', {
                    fortuneType: fortuneResult.name,
                    personalityType: fortuneResult.type,
                    answersCount: this.answers.length
                });

                // âœ… ç‚¹æ•°è¡¨ç¤ºã‚’ç‰¹æ€§ã‚¿ã‚¤ãƒ—è¡¨ç¤ºã«å¤‰æ›´
                finalScore.textContent = fortuneResult.type;
                finalScore.style.fontSize = '2.8em'; // æ–‡å­—ã‚µã‚¤ã‚ºèª¿æ•´
                
                fortuneTypeDisplay.textContent = fortuneResult.name;

                // âœ… å„ªåŠ£ã®ãªã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¤‰æ›´
                positionMessage.textContent = fortuneResult.description;
                actionMessage.textContent = `${fortuneResult.name}ãŒã‚ãªãŸã®ç‰¹æ€§ã¨æœ€ã‚‚èª¿å’Œã—ã€å†…ãªã‚‹æ™ºæ…§ã‚’å¼•ãå‡ºã—ã¦ãã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚`;
                
                resultsCard.style.display = 'block';

                console.log('ğŸ”® ç‰¹æ€§ãƒãƒƒãƒãƒ³ã‚°å®Œäº†:', {
                    type: fortuneResult.type,
                    fortuneType: fortuneResult.name,
                    duration: new Date() - this.startTime
                });
            }

            async startAIAnalysis() {
                // ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤º
                document.getElementById('ai-analysis-button').style.display = 'none';
                
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
                const loadingContainer = document.getElementById('loading-container');
                loadingContainer.style.display = 'block';
                
                console.log('ğŸ”® AIåˆ†æé–‹å§‹');
                
                // ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ¼”å‡º
                await this.animateLoadingSteps();
                
                // AIåˆ†æã‚’å®Ÿè¡Œ
                try {
                    const analysisResult = await this.callAIAnalysis();
                    this.displayAIAnalysis(analysisResult);
                } catch (error) {
                    console.error('AIåˆ†æã‚¨ãƒ©ãƒ¼:', error);
                    this.displayOfflineAnalysis();
                }
                
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’éè¡¨ç¤º
                loadingContainer.style.display = 'none';
            }

            async animateLoadingSteps() {
                const steps = ['step1', 'step2', 'step3', 'step4', 'step5'];
                const durations = [1500, 2000, 1500, 1500, 1000];
                
                for (let i = 0; i < steps.length; i++) {
                    const step = document.getElementById(steps[i]);
                    step.classList.add('active');
                    
                    await new Promise(resolve => setTimeout(resolve, durations[i]));
                    
                    step.classList.remove('active');
                    step.classList.add('completed');
                    step.querySelector('.spinner').textContent = 'âœ…';
                }
            }

            async callAIAnalysis() {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);
                
                try {
                    const response = await fetch('/api/fortune-analyze', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Session-Id': this.sessionId
                        },
                        body: JSON.stringify({
                            answers: this.answers,
                            totalScore: this.totalScore,
                            fortuneType: this.determineFortuneType().name,
                            timestamp: new Date().toISOString()
                        }),
                        signal: controller.signal
                    });
                    
                    clearTimeout(timeoutId);

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    if (!data.success) {
                        throw new Error(data.error || 'AIåˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ');
                    }

                    return data.analysis;
                    
                } catch (error) {
                    clearTimeout(timeoutId);
                    throw error;
                }
            }

            displayAIAnalysis(analysis) {
                const analysisSection = document.getElementById('ai-analysis-section');
                const analysisContent = document.getElementById('analysis-content');
                
                // ã‚·ãƒ³ãƒ—ãƒ«ãªHTMLå¤‰æ›ã§è¦‹ã‚„ã™ãè¡¨ç¤º
                let html = analysis
                    .replace(/\*\*(.*?)\*\*/g, '<h3 style="color: #9c27b0; font-size: 1.4em; margin: 20px 0 10px 0; font-weight: bold;">$1</h3>')
                    .replace(/^- (.+)$/gm, '<li style="margin: 8px 0; font-size: 1.1em; list-style-type: none; padding-left: 20px; position: relative;"><span style="position: absolute; left: 0; color: #9c27b0;">âœ¨</span>$1</li>')
                    .replace(/(\d+)\. (.+)/g, '<div style="margin: 15px 0; padding: 18px; background: linear-gradient(135deg, #f0f7ff 0%, #e8f4fd 100%); border-left: 4px solid #9c27b0; border-radius: 8px; font-size: 1.1em;"><strong style="color: #9c27b0; font-size: 1.1em;">$1.</strong> $2</div>')
                    .replace(/\n\n/g, '</p><p style="font-size: 1.1em; line-height: 1.7; margin: 15px 0; color: #2d3436;">')
                    .replace(/^(?!<)(.+)$/gm, '<p style="font-size: 1.1em; line-height: 1.7; margin: 15px 0; color: #2d3436;">$1</p>');
                
                analysisContent.innerHTML = `
                    <div style="font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 25px; background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                        <div style="text-align: center; margin-bottom: 25px; padding: 20px; background: linear-gradient(135deg, #9c27b0 0%, #673ab7 100%); color: white; border-radius: 12px;">
                            <h2 style="font-size: 1.8em; margin: 0 0 10px 0; font-weight: bold;">ğŸ”® ã‚ãªãŸã®è©³ç´°å ã„åˆ†æ</h2>
                            <p style="margin: 0; font-size: 1em; opacity: 0.95;">AIãŒå°ãå‡ºã—ãŸã€ã‚ãªãŸå°‚ç”¨ã®åˆ†æçµæœ</p>
                        </div>
                        ${html}
                        <div style="margin-top: 25px; padding: 15px; background: #f8f9fa; border-radius: 8px; text-align: center; font-size: 0.9em; color: #6c757d;">
                            <span style="margin-right: 15px;">ğŸ¤– AIåˆ†æã«ã‚ˆã‚‹è¨ºæ–­</span>
                            <span>åˆ†ææ—¥æ™‚: ${new Date().toLocaleString('ja-JP')}</span>
                        </div>
                    </div>
                `;
                analysisSection.style.display = 'block';

                console.log('âœ… AIåˆ†æçµæœè¡¨ç¤ºå®Œäº†');
            }

            displayOfflineAnalysis() {
                const analysisSection = document.getElementById('ai-analysis-section');
                const analysisContent = document.getElementById('analysis-content');
                
                const fortuneType = this.determineFortuneType();
                
                    const analysisHTML = `
                    <div style="background: #fff3cd; color: #856404; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                        <strong>âš ï¸ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰</strong><br>
                        ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã®å•é¡Œã«ã‚ˆã‚Šã€ç°¡æ˜“åˆ†æçµæœã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚
                    </div>
                    
                    <h3>ğŸ”® ã‚ãªãŸã«æœ€é©ãªå ã„ï¼š${fortuneType.name}</h3>
                    
                    <div class="highlight-box">
                        <h4>ğŸ“Š è¨ºæ–­çµæœ</h4>
                        <p><strong>ãƒ‘ãƒ¼ã‚½ãƒŠãƒªãƒ†ã‚£ã‚¿ã‚¤ãƒ—ï¼š${fortuneType.type}</strong></p>
                        <p>${fortuneType.description}</p>
                    </div>
                    
                    <h4>âœ¨ ã‚ãªãŸã®ç‰¹å¾´</h4>
                    <ul>
                        <li>ç‹¬è‡ªã®è¦–ç‚¹ã¨æ„Ÿæ€§ã‚’æŒã£ã¦ã„ã‚‹</li>
                        <li>çŠ¶æ³ã«å¿œã˜ãŸé©åˆ‡ãªåˆ¤æ–­ãŒã§ãã‚‹</li>
                        <li>ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸè€ƒãˆæ–¹ã‚’æŒã£ã¦ã„ã‚‹</li>
                    </ul>
                    
                    <h4>ğŸŒŸ ãŠã™ã™ã‚ã®æ´»ç”¨æ–¹æ³•</h4>
                    <p>${fortuneType.name}ãŒã‚ãªãŸã®ç‰¹æ€§ã¨èª¿å’Œã—ã€äººç”Ÿã®æŒ‡é‡ã¨ãªã‚‹è²´é‡ãªæ´å¯Ÿã‚’æä¾›ã—ã¦ãã‚Œã‚‹ã§ã—ã‚‡ã†ã€‚</p>
                    
                    <div style="background: #d4edda; color: #155724; padding: 20px; border-radius: 10px; margin-top: 20px;">
                        <h4>ğŸ“ è©³ç´°åˆ†æã‚’ã”å¸Œæœ›ã®å ´åˆ</h4>
                        <p>ã‚ˆã‚Šè©³ã—ã„åˆ†æãƒ¬ãƒãƒ¼ãƒˆã‚’ã”å¸Œæœ›ã®å ´åˆã¯ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚</p>
                    </div>
                `;
                
                analysisContent.innerHTML = analysisHTML;
                analysisSection.style.display = 'block';
                
                this.showTemporaryMessage('ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ç°¡æ˜“åˆ†æã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™', 'warning');
            }
        }
    </script>

    <!-- ========================================= -->
    <!-- ğŸ¯ JUDGMENT-ENGINE: åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ -->
    <!-- ä¿®æ­£é »åº¦: é«˜ / å½±éŸ¿ç¯„å›²: è¨ºæ–­çµæœ -->
    <!-- âœ… Option Bä¿®æ­£å®Œäº†: ç‰¹æ€§åˆ¶ã«ã‚ˆã‚‹åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ -->
    <!-- ========================================= -->
    <script>
        // âœ… ã€ä¿®æ­£æ¸ˆã¿ã€‘ç‰¹æ€§ã«ã‚ˆã‚‹é©æ€§ãƒãƒƒãƒãƒ³ã‚°
        // å„ªåŠ£ã®ãªã„ã€ç‰¹æ€§ã«ã‚ˆã‚‹å ã„æ‰‹æ³•åˆ¤å®š
        
        DiagnosisSystem.prototype.determineFortuneType = function() {
            // ç‰¹æ€§åˆ†æã‚’å®Ÿè¡Œ
            const traits = this.analyzePersonalityTraits();
            
            console.log('ğŸ”® ç‰¹æ€§ã«ã‚ˆã‚‹å ã„é©æ€§åˆ†æ:', {
                traits: traits,
                dominantTraits: Object.keys(traits).filter(key => traits[key])
            });

            // âœ… æ–°ã‚·ã‚¹ãƒ†ãƒ : ç‰¹æ€§ã®çµ„ã¿åˆã‚ã›ã«ã‚ˆã‚‹åˆ¤å®šï¼ˆç‚¹æ•°åˆ¶å»ƒæ­¢ï¼‰
            
            // ç›´æ„Ÿ+ç¥ç§˜å‹ â†’ ã‚¿ãƒ­ãƒƒãƒˆç³»
            if (traits.intuitive && traits.mystical) {
                if (traits.ancient) {
                    return {
                        name: 'ã‚¤ãƒ¼ãƒãƒ³ã‚¿ãƒ­ãƒƒãƒˆ',
                        type: 'ç›´æ„Ÿç¥ç§˜å‹',
                        description: 'å¤ä»£ã®æ™ºæ…§ã¨ç¾ä»£ã®ç›´æ„Ÿã‚’èåˆã•ã›ã‚‹ã€æ·±ã„ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«æ€§ã‚’æŒã¤ã‚ãªãŸã‚¿ã‚¤ãƒ—'
                    };
                } else {
                    return {
                        name: 'ã‚¿ãƒ­ãƒƒãƒˆã‚«ãƒ¼ãƒ‰å ã„',
                        type: 'ç›´æ„Ÿé‡è¦–å‹',
                        description: 'è±¡å¾´ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’èª­ã¿è§£ãç›´æ„ŸåŠ›ã«é•·ã‘ãŸã€å‰µé€ çš„æ€è€ƒã‚’æŒã¤ã‚ãªãŸã‚¿ã‚¤ãƒ—'
                    };
                }
            }
            
            // è«–ç†+åˆ†æå‹ â†’ ä½“ç³»çš„å è¡“
            else if (traits.logical && traits.analytical) {
                return {
                    name: 'æ•°ç§˜è¡“',
                    type: 'è«–ç†åˆ†æå‹',
                    description: 'ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨æ³•å‰‡æ€§ã‚’é‡è¦–ã™ã‚‹ã€å®¢è¦³çš„ã§åˆ†æçš„æ€è€ƒã‚’æŒã¤ã‚ãªãŸã‚¿ã‚¤ãƒ—'
                };
            }
            
            // ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«+ç™’ã—å‹ â†’ ã‚ªãƒ©ã‚¯ãƒ«
            else if (traits.spiritual && traits.healing) {
                return {
                    name: 'ã‚ªãƒ©ã‚¯ãƒ«ã‚«ãƒ¼ãƒ‰',
                    type: 'ç™’ã—å¿—å‘å‹',
                    description: 'æ„›ã¨å…‰ã®ã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€å„ªã—ãæ€ã„ã‚„ã‚Šæ·±ã„ã‚ãªãŸã‚¿ã‚¤ãƒ—'
                };
            }
            
            // å®Ÿç”¨+è¦–è¦šå‹ â†’ æ‰‹ç›¸
            else if (traits.practical && traits.visual) {
                return {
                    name: 'æ‰‹ç›¸å ã„',
                    type: 'ç¾å®Ÿé‡è¦–å‹',
                    description: 'å…·ä½“çš„ã§åˆ†ã‹ã‚Šã‚„ã™ã„æƒ…å ±ã‚’å¥½ã‚€ã€åœ°ã«è¶³ãŒã¤ã„ãŸå®Ÿç”¨çš„ãªã‚ãªãŸã‚¿ã‚¤ãƒ—'
                };
            }
            
            // å¤ä»£+ç¥ç§˜å‹ â†’ ãƒ«ãƒ¼ãƒ³
            else if (traits.ancient && traits.mystical) {
                return {
                    name: 'ãƒ«ãƒ¼ãƒ³å ã„',
                    type: 'å¤ä»£æ™ºæ…§å‹',
                    description: 'ä¼çµ±çš„ãªæ™ºæ…§ã¨ç¥ç§˜æ€§ã‚’é‡è¦–ã™ã‚‹ã€æ¢æ±‚å¿ƒæ—ºç››ãªã‚ãªãŸã‚¿ã‚¤ãƒ—'
                };
            }
            
            // è«–ç†+ä½“ç³»å‹ â†’ å æ˜Ÿè¡“
            else if (traits.logical || traits.analytical) {
                return {
                    name: 'è¥¿æ´‹å æ˜Ÿè¡“',
                    type: 'ä½“ç³»æ€è€ƒå‹',
                    description: 'ä½“ç³»çš„ã§ç§‘å­¦çš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å¥½ã‚€ã€è«–ç†çš„æ€è€ƒã‚’æŒã¤ã‚ãªãŸã‚¿ã‚¤ãƒ—'
                };
            }
            
            // ä¼çµ±+å‘¨æœŸå‹ â†’ æ°—å­¦
            else if (traits.traditional && traits.cyclical) {
                return {
                    name: 'ä¹æ˜Ÿæ°—å­¦',
                    type: 'ãƒãƒ©ãƒ³ã‚¹é‡è¦–å‹',
                    description: 'èª¿å’Œã¨ãƒãƒ©ãƒ³ã‚¹ã‚’å¤§åˆ‡ã«ã™ã‚‹ã€å®‰å®šå¿—å‘ã®ã‚ãªãŸã‚¿ã‚¤ãƒ—'
                };
            }
            
            // ç›´æ„Ÿã®ã¿å¼·ã„ â†’ ã‚·ãƒ³ãƒ—ãƒ«ã‚¿ãƒ­ãƒƒãƒˆ
            else if (traits.intuitive) {
                return {
                    name: 'ãƒ¯ãƒ³ã‚ªãƒ©ã‚¯ãƒ«',
                    type: 'ç›´æ„Ÿç‰¹åŒ–å‹',
                    description: 'ç¬é–“çš„ãªã²ã‚‰ã‚ãã‚’å¤§åˆ‡ã«ã™ã‚‹ã€ã‚·ãƒ³ãƒ—ãƒ«ã§é‹­ã„ç›´æ„Ÿã‚’æŒã¤ã‚ãªãŸã‚¿ã‚¤ãƒ—'
                };
            }
            
            // ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«ã®ã¿ â†’ ã‚¨ãƒ³ã‚¸ã‚§ãƒ«ç³»
            else if (traits.spiritual) {
                return {
                    name: 'ã‚¨ãƒ³ã‚¸ã‚§ãƒ«ãƒŠãƒ³ãƒãƒ¼',
                    type: 'ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«å‹',
                    description: 'æ•°å­—ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ã‘å–ã‚‹ã€ç²¾ç¥æ€§ã‚’é‡è¦–ã™ã‚‹ã‚ãªãŸã‚¿ã‚¤ãƒ—'
                };
            }
            
            // å®Ÿç”¨ã®ã¿ â†’ å§“ååˆ¤æ–­
            else if (traits.practical) {
                return {
                    name: 'å§“ååˆ¤æ–­',
                    type: 'å®Ÿç”¨å¿—å‘å‹',
                    description: 'ç¾å®Ÿçš„ã§ç¢ºå®Ÿãªæ–¹æ³•ã‚’å¥½ã‚€ã€å …å®Ÿã§ä¿¡é ¼æ€§ã‚’é‡è¦–ã™ã‚‹ã‚ãªãŸã‚¿ã‚¤ãƒ—'
                };
            }
            
            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: ãƒãƒ©ãƒ³ã‚¹å‹
            else {
                return {
                    name: 'å‹•ç‰©å ã„',
                    type: 'ãƒãƒ©ãƒ³ã‚¹èª¿å’Œå‹',
                    description: 'è¦ªã—ã¿ã‚„ã™ãç†è§£ã—ã‚„ã™ã„æ–¹æ³•ã‚’å¥½ã‚€ã€èª¿å’Œã®ã¨ã‚ŒãŸã‚ãªãŸã‚¿ã‚¤ãƒ—'
                };
            }
        };

        // ğŸ” ã€ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡ã€‘æ€§æ ¼ç‰¹æ€§åˆ†æï¼ˆ11ç‰¹æ€§ã«ã‚ˆã‚‹åˆ†æï¼‰
        DiagnosisSystem.prototype.analyzePersonalityTraits = function() {
            const traits = {
                intuitive: false,    // ç›´æ„Ÿçš„
                logical: false,      // è«–ç†çš„
                spiritual: false,    // ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«
                practical: false,    // å®Ÿç”¨çš„
                mystical: false,     // ç¥ç§˜çš„
                analytical: false,   // åˆ†æçš„
                healing: false,      // ç™’ã—å¿—å‘
                visual: false,       // è¦–è¦šçš„
                traditional: false,  // ä¼çµ±é‡è¦–
                ancient: false,      // å¤ä»£æ™ºæ…§
                cyclical: false      // å‘¨æœŸçš„æ€è€ƒ
            };
            
            // è³ªå•ã‚«ãƒ†ã‚´ãƒªåˆ¥ã®å›ç­”åˆ†æ
            this.answers.forEach((answer, index) => {
                if (!answer) return;
                
                const question = this.questionData[index];
                const score = answer.score;
                
                // ã‚«ãƒ†ã‚´ãƒªã”ã¨ã®ç‰¹æ€§åˆ¤å®š
                switch (question.category) {
                    case 'ç›´æ„Ÿãƒ»æ„Ÿæ€§':
                        if (score >= 8) {
                            traits.intuitive = true;
                            traits.mystical = true;
                        }
                        break;
                    case 'è±¡å¾´ãƒ»è§£é‡ˆåŠ›':
                        if (score >= 8) {
                            traits.mystical = true;
                            traits.ancient = true;
                        }
                        break;
                    case 'è«–ç†ãƒ»åˆ†æ':
                        if (score >= 6) {
                            traits.logical = true;
                            traits.analytical = true;
                        }
                        break;
                    case 'äººé–“é–¢ä¿‚':
                        if (score >= 7) {
                            traits.healing = true;
                        }
                        break;
                    case 'ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«':
                        if (score >= 8) {
                            traits.spiritual = true;
                            traits.mystical = true;
                        }
                        break;
                    case 'æ„æ€æ±ºå®š':
                        if (score >= 7) {
                            traits.intuitive = true;
                        } else if (score <= 4) {
                            traits.logical = true;
                        }
                        break;
                    case 'å€‹æ€§ãƒ»å‰µé€ æ€§':
                        if (score >= 8) {
                            traits.mystical = true;
                        }
                        break;
                    case 'ç’°å¢ƒãƒ»é›°å›²æ°—':
                        if (score >= 8) {
                            traits.spiritual = true;
                        } else if (score <= 5) {
                            traits.practical = true;
                            traits.visual = true;
                        }
                        break;
                }
            });
            
            // ç‰¹æ€§ã®çµ„ã¿åˆã‚ã›èª¿æ•´
            if (traits.logical && traits.analytical) {
                traits.practical = true;
            }
            
            if (traits.mystical && traits.spiritual) {
                traits.ancient = true;
            }
            
            console.log('ğŸ“Š åˆ†æã•ã‚ŒãŸç‰¹æ€§:', traits);
            return traits;
        };
    </script>

    <!-- ========================================= -->
    <!-- ğŸš€ SYSTEM-STARTUP: ã‚·ã‚¹ãƒ†ãƒ èµ·å‹• -->
    <!-- ä¿®æ­£é »åº¦: æ¥µä½ / å½±éŸ¿ç¯„å›²: åˆæœŸåŒ–ã®ã¿ -->
    <!-- ã“ã“ã‚’ä¿®æ­£ã™ã‚‹ã¨: ã‚·ã‚¹ãƒ†ãƒ ã®èµ·å‹•æ–¹æ³•ãŒå¤‰ã‚ã‚Šã¾ã™ -->
    <!-- ========================================= -->
    <script>
        // ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–ï¼ˆåŸºæœ¬çš„ã«ã¯ä¿®æ­£ä¸è¦ï¼‰
        let diagnosisSystem;
        
        // DOMèª­ã¿è¾¼ã¿å®Œäº†ã‚’å¾…ã£ã¦åˆæœŸåŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                diagnosisSystem = new DiagnosisSystem();
            });
        } else {
            diagnosisSystem = new DiagnosisSystem();
        }
        
        console.log('ğŸ”® å ã„é©æ€§è¨ºæ–­ã‚·ã‚¹ãƒ†ãƒ  v2.1 èª­ã¿è¾¼ã¿å®Œäº†');
        console.log('ğŸ” AI Reviewer v4.0 æ¤œè¨¼ãƒ¢ãƒ¼ãƒ‰ - æº–å‚™å®Œäº†');
    </script>
</body>
</html>
